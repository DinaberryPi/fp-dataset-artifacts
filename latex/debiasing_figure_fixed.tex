\begin{figure*}[t]
\centering
\begin{tikzpicture}[
    node distance=0.7cm and 1.2cm,
    box/.style={rectangle, draw, fill=blue!10, text width=2.8cm, align=center, minimum height=0.85cm, rounded corners, font=\footnotesize},
    databox/.style={rectangle, draw, fill=green!10, text width=3.5cm, align=center, minimum height=0.85cm, rounded corners, font=\footnotesize},
    biasbox/.style={rectangle, draw=red, thick, fill=red!5, text width=2.8cm, align=center, minimum height=0.85cm, rounded corners, font=\footnotesize},
    mainbox/.style={rectangle, draw=blue!80, very thick, fill=blue!15, text width=2.8cm, align=center, minimum height=0.85cm, rounded corners, font=\footnotesize},
    arrow/.style={->, >=stealth, thick},
    redarrow/.style={->, >=stealth, thick, red},
    bluearrow/.style={->, >=stealth, thick, blue!80}
]

% Stage 1: Training Data
\node[databox] (data) {\textbf{Training Data}\\[2pt]\scriptsize Premise + Hypothesis $\rightarrow$ Label};

% Stage 2: Two parallel paths
\node[biasbox, below left=of data, xshift=-0.4cm] (hyp) {\textbf{Hypothesis-}\\[-1pt]\textbf{Only Model}\\[2pt]\scriptsize Detects Artifacts};
\node[box, below right=of data, xshift=0.4cm] (full) {\textbf{Full Input}\\[2pt]\scriptsize Premise + Hypothesis};

% Arrows from data
\draw[redarrow] (data.south) -- ++(0,-0.3) -| (hyp.north);
\draw[arrow] (data.south) -- ++(0,-0.3) -| (full.north);

% Stage 3: Confidence
\node[biasbox, below=of hyp] (conf) {\textbf{Confidence Scores}\\[2pt]\scriptsize $\max(\mathbf{p}_i)$};
\draw[redarrow] (hyp) -- (conf);

% Stage 4: Weights
\node[box, below=of conf] (weight) {\textbf{Compute Weights}\\[2pt]\scriptsize $w_i = \frac{1}{1+\max(\mathbf{p}_i)}$};
\draw[arrow] (conf) -- (weight);

% Stage 5: Main model
\node[mainbox, below=1.0cm of full] (main) {\textbf{Main Model}\\[2pt]\scriptsize ELECTRA-small};
\draw[arrow] (full) -- (main);
\draw[arrow] (weight.east) -- ++(0.3,0) |- (main.west) node[pos=0.2, above=0.15cm, font=\tiny, fill=white, inner sep=1pt] {reweight loss};

% Stage 6: Output
\node[mainbox, below=of main] (output) {\textbf{Debiased Model}\\[2pt]\scriptsize Reduced Artifact\\Reliance};
\draw[bluearrow] (main) -- (output) node[midway, right, font=\tiny] {$\mathcal{L}=\sum w_i\cdot$CE};

% Stage labels
\node[font=\small\bfseries, left=1.2cm of data] {Stage 1};
\node[font=\small\bfseries, left=1.2cm of hyp, yshift=0.2cm] {Stage 2};
\node[font=\small\bfseries, left=1.2cm of weight] {Stage 3};
\node[font=\small\bfseries, left=1.2cm of main, yshift=0.3cm] {Stage 4};

\end{tikzpicture}
\caption{Confidence-based reweighting debiasing architecture. The hypothesis-only bias model (red boxes) identifies artifact-prone examples by producing high-confidence predictions. These confidence scores are inverted to compute training weights, down-weighting easy artifact examples and up-weighting examples requiring genuine reasoning. The main model (blue boxes) is then trained with reweighted loss, resulting in reduced reliance on dataset artifacts.}
\label{fig:debiasing}
\end{figure*}

